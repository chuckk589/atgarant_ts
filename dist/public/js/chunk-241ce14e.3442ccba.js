(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-241ce14e"],{"2fb8":function(t,e,a){"use strict";a.r(e);var r=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("CExtendedModal",{attrs:{vis:t.modalConfig.show,mData:t.modalConfig.data},on:{"modal-closed":function(e){return t.closeModalHandler()}},scopedSlots:t._u([{key:"type",fn:function(e){var r=e.item;return[a("CSelect",{attrs:{label:"Тип отзыва",options:[{value:"positive",label:"Положительный"},{value:"negative",label:"Отрицательный"}],value:r.value},on:{"update:value":function(e){return t.$set(r,"value",e)}}})]}},{key:"text",fn:function(e){var r=e.item;return[a("CTextarea",{attrs:{label:"Текст отзыва",value:r.value},on:{"update:value":function(e){return t.$set(r,"value",e)}}})]}}])}),a("CDataTable",{attrs:{items:t.offers,fields:t.fields,sorter:"",columnFilter:""},scopedSlots:t._u([{key:"initiator",fn:function(e){var r=e.item;return[a("td",{attrs:{"data-label":"Инициатор сделки"}},[t._v(" "+t._s(r.initiator.username||r.initiator.chat_id)+" ")])]}},{key:"offerStatus",fn:function(e){var r=e.item;return[a("td",{attrs:{"data-label":"Статус сделки"}},[t._v(" "+t._s(r.offerStatus.name)+" ")])]}},{key:"partner",fn:function(e){var r=e.item;return[a("td",{attrs:{"data-label":"Компаньон"}},[t._v(" "+t._s(r.partner.username||r.partner.chat_id)+" ")])]}},{key:"paymentMethod",fn:function(e){var r=e.item;return[a("td",{attrs:{"data-label":"Способ оплаты"}},[t._v(" "+t._s(r.paymentMethod.name)+" ")])]}},{key:"createdAt",fn:function(e){var r=e.item;return[a("td",{attrs:{"data-label":"Дата создания"}},[t._v(" "+t._s(new Date(r.createdAt).toLocaleString())+" ")])]}},{key:"role",fn:function(e){var r=e.item;return[a("td",{attrs:{"data-label":"Роль инициатора"}},[t._v(" "+t._s("seller"===r.role?"Продавец":"Покупатель")+" ")])]}},{key:"action",fn:function(e){var r=e.item;return[a("td",[a("CDropdown",{staticClass:"m-2",attrs:{"toggler-text":"Действия",color:"secondary"}},[t.isOwner(r)&&t.isSeller(r)?a("CDropdownItem",{attrs:{disabled:"payed"!==r.offerStatus.value},on:{click:function(e){return t.nextStepAction(r)}}},[t._v("Подтвердить отправку")]):t._e(),t.isOwner(r)?a("CDropdownItem",{on:{click:function(e){return t.setWallet(r)}}},[t._v("Указать кошелек")]):t._e(),t.isOwner(r)&&t.isSeller(r)?a("CDropdownItem",{attrs:{disabled:t.isPayable(r)},on:{click:function(e){return t.receivePayout(r)}}},[t._v("Получить выплату")]):t._e(),t.isOwner(r)&&!t.isSeller(r)?a("CDropdownItem",{attrs:{disabled:"shipped"!==r.offerStatus.value},on:{click:function(e){return t.nextStepAction(r)}}},[t._v("Подтвердить получение")]):t._e(),t.isFeedbackable(r)?a("CDropdownItem",{on:{click:function(e){return t.leaveFeedback(r)}}},[t._v("Оставить отзыв")]):t._e(),t.isOwner(r)?a("CDropdownItem",{attrs:{disabled:"closed"===r.offerStatus.value||"arbitrary"===r.offerStatus.value||"pending"===r.offerStatus.value},on:{click:function(e){return t.openArbitrary(r)}}},[t._v("Арбитраж")]):t._e()],1)],1)]}}])})],1)},n=[],i=a("7a07"),l=a("d35b"),o={name:"Offers",components:{CExtendedModal:i["a"]},mixins:[l["a"]],data:function(){return{modalConfig:{show:!1,data:{}},offers:[],fields:[{key:"id",label:"Id"},{key:"offerValue",label:"Сумма сделки"},{key:"initiator",label:"Инициатор сделки"},{key:"partner",label:"Компаньон"},{key:"offerStatus",label:"Статус сделки"},{key:"paymentMethod",label:"Способ оплаты"},{key:"productAdditionalDetails",label:"Доп. детали"},{key:"productDetails",label:"Детали"},{key:"refundDetails",label:"Возврат"},{key:"restDetails",label:"Остальное"},{key:"role",label:"Роль инициатора"},{key:"sellerWalletData",label:"Кошелек продавца"},{key:"buyerWalletData",label:"Кошелек покупателя"},{key:"shippingDetails",label:"Доставка"},{key:"createdAt",label:"Дата создания"},{key:"action",label:"",filter:!1,sorter:!1}]}},mounted:function(){var t=this;this.$http({method:"GET",url:"/v1/offer?userId=".concat(1===this.userData.role?"":this.userData.id)}).then((function(e){t.offers=1===t.userData.role?e.data:e.data.filter((function(e){return!(e.partner.id==t.userData.id&&"pending"==e.offerStatus.value)}))}))},methods:{leaveFeedback:function(t){this.modalConfig.data={cur:t,fields:[{label:"text",value:""},{label:"type",value:"positive"}],footer:"Сохранить",header:"Редактировать",type:"feedback"},this.modalConfig.show=!0},setWallet:function(t){this.modalConfig.data={cur:t,fields:[{label:"Кошелек",value:this.isSeller(t)?t.sellerWalletData:t.buyerWalletData}],footer:"Сохранить",header:"Редактировать",type:"wallet"},this.modalConfig.show=!0},openArbitrary:function(t){this.modalConfig.data={cur:t,fields:[{label:"Причина",value:""}],footer:"Отправить",header:"Обращение в арбитраж",type:"arbitrary"},this.modalConfig.show=!0},closeModalHandler:function(){var t=this;if("wallet"==this.modalConfig.data.type){var e=this.modalConfig.data.fields.find((function(t){return"Кошелек"==t.label})).value,a=this.isSeller(this.modalConfig.data.cur);this.$http({method:"PUT",url:"/v1/offer/".concat(this.modalConfig.data.cur.id,"/"),data:{seller:a,walletData:e}}).then((function(r){"error"!==r.data.status?t.modalConfig.data.cur[!0===a?"sellerWalletData":"buyerWalletData"]=e:alert("Кошелек указан неверно")}))}else if("arbitrary"==this.modalConfig.data.type){var r=this.modalConfig.data.fields.find((function(t){return"Причина"==t.label})).value;this.$http({method:"POST",url:"/v1/offer/".concat(this.modalConfig.data.cur.id,"/arbitrary/"),data:{reason:r,initiator:this.userData.id}}).then((function(e){Object.assign(t.offers.find((function(e){return e.id===t.modalConfig.data.cur.id})).offerStatus,e.data.newStatus)}))}else if("feedback"==this.modalConfig.data.type){var n=this.modalConfig.data.fields.find((function(t){return"type"==t.label})).value,i=this.modalConfig.data.fields.find((function(t){return"text"==t.label})).value;this.$http({method:"POST",url:"/v1/review/",data:{offerId:this.modalConfig.data.cur.id,authorId:this.userData.id,recipientId:this.modalConfig.data.cur.partnerId===this.userData.id?this.modalConfig.data.cur.initiatorId:this.modalConfig.data.cur.partnerId,rate:n,text:i}}).then((function(){t.modalConfig.data.cur.reviews.push({authorId:t.userData.id})}))}},receivePayout:function(t){var e=this;this.$http({method:"POST",url:"/v1/offer/".concat(t.id,"/action/")}).then((function(a){"error"!==a.status&&Object.assign(e.offers.find((function(e){return e.id===t.id})).offerStatus,a.data.newStatus)}))},isPayable:function(t){return!("arrived"===t.offerStatus.value&&t.sellerWalletData)},isSeller:function(t){var e="seller"===t.role?t.initiator.id:t.partner.id;return e===this.userData.id},isFeedbackable:function(t){var e=this;return t.offerStatusId>5&&!t.reviews.find((function(t){return t.authorId===e.userData.id}))},isOwner:function(t){return this.userData.id===t.initiator.id||this.userData.id===t.partner.id},nextStepAction:function(t){this.$http({method:"POST",url:"/v1/offer/".concat(t.id,"/action/")}).then((function(e){"error"!==e.status&&(t.offerStatus=Object.assign({},e.data.newStatus))}))}}},s=o,u=(a("cd64"),a("2877")),d=Object(u["a"])(s,r,n,!1,null,null,null);e["default"]=d.exports},"7a07":function(t,e,a){"use strict";var r=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("CModal",{attrs:{show:t.vis,title:t.mData.header},on:{"update:show":function(e){t.vis=e}},scopedSlots:t._u([{key:"footer",fn:function(){return[t.disableFooter?a("p"):a("CButton",{attrs:{color:"primary"},on:{click:function(e){return t.closeModal()}}},[t._v(t._s(t.mData.footer))])]},proxy:!0}])},[t._t("content"),t._l(t.mData.fields,(function(e,r){return[t.$scopedSlots[e.label]?[t._t(e.label,null,{item:e})]:e.select?a("CSelect",{key:r,attrs:{label:e.label,value:e.value,options:e.select},on:{"update:value":function(a){return t.$set(e,"value",a)}}}):a("CInput",{key:r,attrs:{label:e.label},model:{value:e.value,callback:function(a){t.$set(e,"value",a)},expression:"field.value"}})]}))],2)},n=[],i={name:"ExtendedModal",data:function(){return{}},props:{vis:Boolean,disableFooter:Boolean,mData:Object},methods:{closeModal:function(){this.$emit("modal-closed"),this.vis=!1}}},l=i,o=a("2877"),s=Object(o["a"])(l,r,n,!1,null,null,null);e["a"]=s.exports},b1ba:function(t,e,a){},cd64:function(t,e,a){"use strict";a("b1ba")}}]);
//# sourceMappingURL=chunk-241ce14e.3442ccba.js.map